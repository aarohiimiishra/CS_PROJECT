<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vior√° - Register</title>
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background: #fff7f0; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 90vh; 
        }
        .container { 
            width: 380px; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            border-top: 5px solid #ea5a3c; 
        }
        h2 { color: #ea5a3c; text-align: center; margin-top: 0; }
        
        label { font-size: 0.85rem; font-weight: 600; color: #555; display: block; margin-top: 12px; }
        
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            box-sizing: border-box; 
            font-family: inherit;
        }

        #ageDisplay {
            font-size: 0.85rem;
            color: #ea5a3c;
            font-weight: bold;
            margin-top: 5px;
            text-align: right;
            min-height: 1.2em;
        }

        button { 
            width: 100%; 
            padding: 12px; 
            margin-top: 25px; 
            border-radius: 50px; 
            border: none; 
            background: linear-gradient(45deg, #f9b652, #ea5a3c); 
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 1rem;
            transition: 0.3s;
        }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .links { text-align: center; margin-top: 20px; font-size: 0.9rem; }
        a { color: #ea5a3c; text-decoration: none; font-weight: 600; }
        
        .error { color: red; font-size: 0.8rem; margin-top: 5px; text-align: center; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Create Account</h2>
        
        <label>Name</label>
        <input type="text" id="regName" placeholder="Letters only (Min 2)" 
               oninput="this.value=this.value.replace(/[^A-Za-z\s]/g,'')">
        
        <label>Password</label>
        <input type="password" id="regPass" placeholder="Min 6 characters">

        <label>Date of Birth</label>
        <input type="date" id="regDOB">
        <div id="ageDisplay"></div>

        <label>Dietary Preference</label>
        <select id="regDiet">
            <option value="veg">Vegetarian</option>
            <option value="non-veg">Non-Vegetarian</option>
            <option value="vegan">Vegan</option>
        </select>

        <div style="display:flex; gap:10px;">
            <div style="flex:1">
                <label>Height (cm)</label>
                <input type="number" id="regHeight" placeholder="Max 300" max="300"
                       oninput="if(this.value > 300) this.value=300;">
            </div>
            <div style="flex:1">
                <label>Weight (kg)</label>
                <input type="number" id="regWeight" placeholder="Max 600" max="600"
                       oninput="if(this.value > 600) this.value=600;">
            </div>
        </div>

        <label>Security Question: What is your favourite food?</label>
        <input type="text" id="regFood" placeholder="e.g. Pizza" 
               oninput="this.value=this.value.replace(/[^A-Za-z\s]/g,'')">

        <button id="regBtn">Register</button>
        <div id="errMsg" class="error"></div>

        <div class="links">
            Already have an account? <a href="loginpage.html">Login here</a>
        </div>
    </div>

    <script>
        // age calc
        const dobInput = document.getElementById('regDOB');
        const ageDisplay = document.getElementById('ageDisplay');

        dobInput.addEventListener('change', function() {
            if(!this.value) return;
            
            const dob = new Date(this.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            if(age < 1) {
                ageDisplay.style.color = "red";
                ageDisplay.innerText = "Invalid Age (Must be 1+)";
            } else {
                ageDisplay.style.color = "#ea5a3c";
                ageDisplay.innerText = "You are " + age + " years old";
            }
        });
        document.getElementById('regBtn').addEventListener('click', function() {
            const msg = document.getElementById('errMsg');
            msg.innerText = ""; // Clear errors
            
            let users = JSON.parse(localStorage.getItem('vioraUsers')) || [];

            // Get Values
            const name = document.getElementById('regName').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            const dob = document.getElementById('regDOB').value;
            const diet = document.getElementById('regDiet').value;
            const height = document.getElementById('regHeight').value;
            const weight = document.getElementById('regWeight').value;
            const food = document.getElementById('regFood').value.trim();
            // Name Validation
            if (name.length < 2) {
                msg.innerText = "Name must have at least 2 letters.";
                return;
            }

            //Password Validation
            if (pass.length < 6) {
                msg.innerText = "Password must be at least 6 characters.";
                return;
            }
            // Age Validation
            if (!dob) {
                msg.innerText = "Please select Date of Birth.";
                return;
            }
            // Re-calculate age to be sure
            const dobDate = new Date(dob);
            const today = new Date();
            let age = today.getFullYear() - dobDate.getFullYear();
            const m = today.getMonth() - dobDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dobDate.getDate())) age--;
            
            if (age < 1) {
                msg.innerText = "Age must be 1 year or more.";
                return;
            }
            // Height/Weight Validation
            if (!height || height > 300) {
                msg.innerText = "Enter valid Height (Max 300cm).";
                return;
            }
            if (!weight || weight > 600) {
                msg.innerText = "Enter valid Weight (Max 600kg).";
                return;
            }
            // security question
            if (food === "") {
                msg.innerText = "Please answer the security question.";
                return;
            }
            if(users.find(u => u.name.toLowerCase() === name.toLowerCase())) {
                alert("User name already exists! Please choose another.");
                return;
            }
            // saving
            const newUser = {
                name: name,
                pass: pass,
                dob: dob,
                diet: diet,
                height: height,
                weight: weight,
                food: food.toLowerCase(),
                bmi: (weight / ((height/100) ** 2)).toFixed(2)
            };
            users.push(newUser);
            localStorage.setItem('vioraUsers', JSON.stringify(users));
            alert("Registration Successful!\nBMI: " + newUser.bmi + "\nDiet: " + diet);
            window.location.href = "loginpage.html"; // Go to Login
        });
    </script>
</body>
</html>
